<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\liquidity\aave\AaveLiquidityProxy.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">all files</a> / <a href="index.html">contracts/liquidity/aave/</a> AaveLiquidityProxy.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/21</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/6</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/9</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/21</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*
&nbsp;
    Copyright 2020 Kollateral LLC
    Copyright 2020-2021 ARM Finance LLC
&nbsp;
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at
&nbsp;
    http://www.apache.org/licenses/LICENSE-2.0
&nbsp;
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
&nbsp;
*/
// SPDX-License-Identifier: Apache-2.0
pragma solidity ^0.8.1;
&nbsp;
import "./ILendingPool.sol";
import "./ILendingPoolAddressesProvider.sol";
import "./ILendingPoolCore.sol";
import "./ILendingPoolParametersProvider.sol";
import "../ILiquidityProxy.sol";
import "../../__oz__/math/SafeMath.sol";
import "../../__oz__/token/ERC20/IERC20.sol";
import "../../common/invoke/IInvoker.sol";
import "../../common/utils/BalanceCarrier.sol";
&nbsp;
contract AaveLiquidityProxy is BalanceCarrier, ILiquidityProxy {
	using SafeMath for uint256;
&nbsp;
	address internal ETHER_TOKEN_ADDRESS = 0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE;
&nbsp;
	ILendingPoolAddressesProvider internal _lendingPoolAddressProvider;
&nbsp;
	address payable internal _scheduleInvokerAddress;
&nbsp;
<span class="fstat-no" title="function not covered" >	constructor(ILendingPoolAddressesProvider lendingPoolAddressProvider) BalanceCarrier(ETHER_TOKEN_ADDRESS) {</span>
<span class="cstat-no" title="statement not covered" >		_lendingPoolAddressProvider = lendingPoolAddressProvider</span>;
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function getRepaymentAddress(address tokenAddress) external view override returns (address) {</span>
<span class="cstat-no" title="statement not covered" >		return _lendingPoolAddressProvider.getLendingPoolCore();</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function getTotalReserve(address tokenAddress) external view override returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		address core = _lendingPoolAddressProvider.getLendingPoolCore();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		if (isRegistered(tokenAddress)) {</span>
<span class="cstat-no" title="statement not covered" >			return tokenAddress == address(1) ? core.balance : IERC20(tokenAddress).balanceOf(core);</span>
		}
&nbsp;
<span class="cstat-no" title="statement not covered" >		return 0;</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function getRepaymentAmount(address tokenAddress, uint256 tokenAmount) external view override returns (uint256) {</span>
<span class="cstat-no" title="statement not covered" >		ILendingPoolParametersProvider params =</span>
			ILendingPoolParametersProvider(_lendingPoolAddressProvider.getLendingPoolParametersProvider());
<span class="cstat-no" title="statement not covered" >		(uint256 totalFeeBips, uint256 _void) = params.getFlashLoanFeesInBips();</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >		uint256 amountFee = tokenAmount.mul(totalFeeBips).div(10000);</span>
<span class="cstat-no" title="statement not covered" >		return tokenAmount.add(amountFee);</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function borrow(address tokenAddress, uint256 tokenAmount) external override {</span>
<span class="cstat-no" title="statement not covered" >		_scheduleInvokerAddress = payable(msg.sender)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		ILendingPool lendingPool = ILendingPool(_lendingPoolAddressProvider.getLendingPool());</span>
<span class="cstat-no" title="statement not covered" >		lendingPool.flashLoan(address(this), remapTokenAddress(tokenAddress), tokenAmount, "")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		_scheduleInvokerAddress = payable(address(0))</span>;
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function executeOperation(</span>
		address _reserve,
		uint256 _amount,
		uint256 _fee,
		bytes calldata _params
	) external {
<span class="cstat-no" title="statement not covered" >		require(_scheduleInvokerAddress != address(0), "AaveLiquidityProxy: not scheduled")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		require(transfer(_reserve, _scheduleInvokerAddress, _amount), "AaveLiquidityProxy: transfer to invoker failed")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		IInvoker invoker = IInvoker(_scheduleInvokerAddress);</span>
<span class="cstat-no" title="statement not covered" >		invoker.invokeCallback()</span>;
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function isRegistered(address tokenAddress) internal view returns (bool) {</span>
<span class="cstat-no" title="statement not covered" >		ILendingPoolCore core = ILendingPoolCore(_lendingPoolAddressProvider.getLendingPoolCore());</span>
<span class="cstat-no" title="statement not covered" >		return core.getReserveIsActive(remapTokenAddress(tokenAddress));</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function remapTokenAddress(address tokenAddress) internal view returns (address) {</span>
<span class="cstat-no" title="statement not covered" >		return tokenAddress == address(1) ? ETHER_TOKEN_ADDRESS : tokenAddress;</span>
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	fallback() external {}</span>
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Feb 11 2021 12:57:41 GMT+0100 (Ora standard dell’Europa centrale)
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>

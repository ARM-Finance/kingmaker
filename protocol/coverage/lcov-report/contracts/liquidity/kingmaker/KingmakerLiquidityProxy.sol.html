<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts\liquidity\kingmaker\KingmakerLiquidityProxy.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../../../prettify.css" />
    <link rel="stylesheet" href="../../../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../../../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../../../index.html">all files</a> / <a href="index.html">contracts/liquidity/kingmaker/</a> KingmakerLiquidityProxy.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">37.5% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>9/24</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">16.67% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>1/6</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">58.33% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>7/12</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">37.5% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>9/24</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">15×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-yes">5×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">23×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">/*
&nbsp;
    Copyright 2020 Kollateral LLC
    Copyright 2020-2021 ARM Finance LLC
&nbsp;
    Licensed under the Apache License, Version 2.0 (the "License");
    you may not use this file except in compliance with the License.
    You may obtain a copy of the License at
&nbsp;
    http://www.apache.org/licenses/LICENSE-2.0
&nbsp;
    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
&nbsp;
*/
// SPDX-License-Identifier: Apache-2.0
pragma solidity ^0.8.1;
&nbsp;
import "../ILiquidityProxy.sol";
import "../../__oz__/utils/Pausable.sol";
import "../../__oz__/access/Ownable.sol";
import "../../common/invoke/IInvoker.sol";
import "../../common/utils/BalanceCarrier.sol";
import "../../token/CollateralizedToken.sol";
import "../../token/ktoken/KToken.sol";
&nbsp;
contract KingmakerLiquidityProxy is BalanceCarrier, IInvokable, ILiquidityProxy, Ownable {
	mapping(address =&gt; address) _tokenAddressToKTokenAddress;
&nbsp;
	address payable internal _scheduleInvokerAddress;
	address internal _scheduleTokenAddress;
	uint256 internal _scheduleTokenAmount;
&nbsp;
	constructor() BalanceCarrier(address(1)) {}
&nbsp;
	function registerPool(address tokenAddress, address kTokenAddress) external onlyOwner {
		_tokenAddressToKTokenAddress[tokenAddress] = kTokenAddress;
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function deregisterPool(address tokenAddress) external onlyOwner {</span>
<span class="cstat-no" title="statement not covered" >		_tokenAddressToKTokenAddress[tokenAddress] = address(0)</span>;
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function getRepaymentAddress(address tokenAddress) external view override returns (address) {</span>
<span class="cstat-no" title="statement not covered" >		return poolAddress(tokenAddress);</span>
	}
&nbsp;
	function getTotalReserve(address tokenAddress) external view override returns (uint256) {
		<span class="missing-if-branch" title="else path not taken" >E</span>if (isRegistered(tokenAddress) &amp;&amp; !isPaused(tokenAddress)) {
			CollateralizedToken pool = CollateralizedToken(poolAddress(tokenAddress));
			return pool.totalReserve();
		}
<span class="cstat-no" title="statement not covered" >		return 0;</span>
	}
&nbsp;
	function getRepaymentAmount(address tokenAddress, uint256 tokenAmount) external view override returns (uint256) {
		KToken pool = KToken(poolAddress(tokenAddress));
		return pool.calculateRepaymentAmount(tokenAmount);
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function borrow(address tokenAddress, uint256 tokenAmount) external override {</span>
<span class="cstat-no" title="statement not covered" >		_scheduleInvokerAddress = payable(msg.sender)</span>;
<span class="cstat-no" title="statement not covered" >		_scheduleTokenAddress = tokenAddress</span>;
<span class="cstat-no" title="statement not covered" >		_scheduleTokenAmount = tokenAmount</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		KToken pool = KToken(poolAddress(tokenAddress));</span>
<span class="cstat-no" title="statement not covered" >		pool.invoke(address(this), "", tokenAmount)</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		_scheduleInvokerAddress = payable(address(0))</span>;
<span class="cstat-no" title="statement not covered" >		_scheduleTokenAddress = address(0)</span>;
<span class="cstat-no" title="statement not covered" >		_scheduleTokenAmount = 0</span>;
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	function execute(bytes calldata data) external payable override {</span>
<span class="cstat-no" title="statement not covered" >		require(_scheduleInvokerAddress != address(0), "KingmakerLiquidityProxy: not scheduled")</span>;
&nbsp;
<span class="cstat-no" title="statement not covered" >		require(</span>
			transfer(_scheduleTokenAddress, _scheduleInvokerAddress, _scheduleTokenAmount),
			"KingmakerLiquidityProxy: transfer to invoker failed"
		);
&nbsp;
<span class="cstat-no" title="statement not covered" >		IInvoker invoker = IInvoker(_scheduleInvokerAddress);</span>
<span class="cstat-no" title="statement not covered" >		invoker.invokeCallback()</span>;
	}
&nbsp;
	function poolAddress(address tokenAddress) internal view returns (address) {
		return _tokenAddressToKTokenAddress[tokenAddress];
	}
&nbsp;
	function isRegistered(address tokenAddress) internal view returns (bool) {
		return poolAddress(tokenAddress) != address(0);
	}
&nbsp;
	function isPaused(address tokenAddress) internal view returns (bool) {
		return Pausable(poolAddress(tokenAddress)).paused();
	}
&nbsp;
<span class="fstat-no" title="function not covered" >	fallback() external {}</span>
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Thu Feb 11 2021 12:57:41 GMT+0100 (Ora standard dell’Europa centrale)
</div>
</div>
<script src="../../../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../../../sorter.js"></script>
</body>
</html>
